services:
  db:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: taskmanager-db
    environment:
      ACCEPT_EULA: "Y"
      MSSQL_SA_PASSWORD: ${MSSQL_SA_PASSWORD}
    ports:
      - "1433:1433"
    volumes:
      - mssql_data:/var/opt/mssql

  backend:
    image: mcr.microsoft.com/dotnet/sdk:9.0
    container_name: taskmanager-backend
    working_dir: /src
    volumes:
      - ./backend:/src
    command: >
      sh -c "dotnet --info &&
             dotnet new webapi -n TaskManager.Api -o TaskManager.Api --force &&
             dotnet run --project TaskManager.Api --urls http://0.0.0.0:8080"
    ports:
      - "8080:8080"
    depends_on:
      - db

  frontend:
    image: node:20-alpine
    container_name: taskmanager-frontend
    working_dir: /app
    volumes:
      - ./frontend:/app
    command: >
      sh -c "npm create vite@latest . -- --template react-ts --force &&
             npm install &&
             npm run dev -- --host 0.0.0.0 --port 5173"
    environment:
      - VITE_API_URL=http://localhost:8080
    ports:
      - "5173:5173"
    depends_on:
      - backend

volumes:
  mssql_data: